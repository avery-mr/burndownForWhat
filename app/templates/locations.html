{% extends "layout.html" %}

{% block content %}
<script async defer
src="https://maps.googleapis.com/maps/api/js?key=YOURAPIKEYp&libraries=places">
</script>
<script>
var map;
var directionsService;
var directionsRenderer;
var autocomplete;
var currentLocation;
var distanceElement;

function initMap() {
  // Initialize the map
  map = new google.maps.Map(document.getElementById("map"), {
    center: { lat: -34.397, lng: 150.644 },
    zoom: 8
  });

  // Initialize directions service and renderer
  directionsService = new google.maps.DirectionsService();
  directionsRenderer = new google.maps.DirectionsRenderer();
  directionsRenderer.setMap(map);

  // Initialize the search bar (Autocomplete)
  var input = document.getElementById("search-input");
  autocomplete = new google.maps.places.Autocomplete(input);
  autocomplete.bindTo('bounds', map);

  // Use HTML5 Geolocation to get the current position
  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(function(position) {
      currentLocation = {
        lat: position.coords.latitude,
        lng: position.coords.longitude
      };
      map.setCenter(currentLocation);
      new google.maps.Marker({
        position: currentLocation,
        map: map,
        title: "Current Location"
      });
    });
  } else {
    console.log("Geolocation is not supported by this browser.");
  }

  // Listen for the search input selection
  autocomplete.addListener('place_changed', function() {
    var place = autocomplete.getPlace();
    if (!place.geometry) {
      console.log("Returned place contains no geometry");
      return;
    }

    // Set map's bounds to the selected place
    if (place.geometry.viewport) {
      map.fitBounds(place.geometry.viewport);
    } else {
      map.setCenter(place.geometry.location);
      map.setZoom(17);
    }

    // Show directions from current location to the selected place
    if (currentLocation) {
      calculateAndDisplayRoute(place.geometry.location);
    } else {
      console.log("Current location is not available.");
    }
  });
}

function calculateAndDisplayRoute(destination) {
  directionsService.route(
    {
      origin: currentLocation,
      destination: destination,
      travelMode: google.maps.TravelMode.DRIVING // You can change to 'WALKING', 'BICYCLING', etc.
    },
    function(response, status) {
      if (status === "OK") {
        directionsRenderer.setDirections(response);

        // Extract and display the distance from the response
        var route = response.routes[0];
        var distance = route.legs[0].distance.text;
        var duration = route.legs[0].duration.text;
        distanceElement.innerHTML = "Distance: " + distance + " (" + duration + ")";
      } else {
        window.alert("Directions request failed due to " + status);
      }
    }
  );
}
</script>

<div class="container">
    <h1>Locations</h1>
</div>

<h2>Climbing Locations in Denver</h2>
<br>

<iframe src="https://www.google.com/maps/embed?pb=!1m16!1m12!1m3!1d785715.2579891625!2d-105.72118860838015!3d39.71268271851661!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!2m1!1sclimbing%20gyms%20in%20denver%2C%20co!5e0!3m2!1sen!2sus!4v1744604660394!5m2!1sen!2sus" width="600" height="450" style="border:0;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>

{% endblock %}
